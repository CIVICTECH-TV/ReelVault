# ReelVault 実装計画書

## 📋 プロジェクト概要

**目標**: 映像制作者向け長期アーカイブストレージ補助ツールの開発
**アーキテクチャ**: 常駐アプリケーション + ハイブリッドSaaS
**技術スタック**: Electron/Tauri, Node.js/Python API, AWS S3 Deep Archive, CloudFormation
**開発期間**: 7ヶ月（v1.0〜v1.2）

## 🔄 変更履歴

### 📅 2024-12-06: アーキテクチャ大幅変更
**変更理由**: ユーザビリティ向上とビジネスモデル最適化

#### 🏗️ **アーキテクチャ変更**
- **従来**: CLI ベース → **新**: 常駐アプリケーション + フォルダ監視
- **従来**: ローカル Web UI → **新**: SaaS API + 管理機能
- **従来**: 手動実行 → **新**: 自動バックアップ（監視フォルダ）

#### 📊 **工数・期間変更**
- **従来**: 11週間 (65日) → **新**: 13週間 (76日) 
- **Phase 1**: 32日 → 38日 (+6日)
- **Phase 2**: 17日 → 22日 (+5日)

#### 🎯 **ターゲットユーザー変更**
- **従来**: 技術に詳しい映像制作者 → **新**: 一般的な映像制作者
- **従来**: CLI操作可能ユーザー → **新**: ドラッグ&ドロップ操作ユーザー

---

## 🎯 フェーズ別実装計画

### Phase 1: v1.0 常駐アプリ基盤（優先度: 最高）
**期間**: 4-5週間  
**目標**: 常駐アプリによる自動バックアップシステム

#### 🖥️ 常駐アプリケーション基盤
1. **常駐アプリケーション基盤構築** (5日)
   - Electron/Tauri技術選定・環境構築
   - システムトレイ常駐機能
   - Cross-platform対応 (macOS/Windows/Linux)
   - 基本UI実装 (設定画面、進捗表示)

2. **フォルダ監視システム** (4日)
   - ファイルシステム監視 (FSEvents/ReadDirectoryChangesW/inotify)
   - リアルタイム変更検知
   - ファイルフィルタリング (映像ファイル優先)
   - 監視対象フォルダ管理

3. **バックグラウンドアップロード** (5日)
   - 非同期アップロード処理エンジン
   - キューイングシステム
   - 進捗管理・システムトレイ通知
   - 中断・再開機能

#### ☁️ AWS基盤・認証
4. **AWS CloudFormation テンプレート作成** (5日)
   - S3バケット自動作成
   - ライフサイクルポリシー設定
   - Cross-Account IAMロール・ポリシー定義
   - セキュリティ設定・暗号化

5. **AWS認証・設定管理** (4日) *(+1日)*
   - AWS CLI設定読み込み
   - Cross-Account Role対応
   - Boto3 クライアント初期化
   - 認証エラーハンドリング・SaaS連携準備

6. **ファイルアップロード機能** (6日) *(+1日)*
   - 単一ファイル・フォルダ再帰アップロード
   - マルチパートアップロード (大容量対応)
   - バックグラウンド処理対応
   - 重複チェック・スキップ機能

7. **復元機能** (5日)
   - Deep Archive復元リクエスト
   - 復元状況確認・監視
   - 復元完了通知 (システムトレイ)
   - 一時ダウンロード機能

#### 🛠 サポート機能
8. **メタデータ管理** (4日)
   - SQLite データベース設計
   - ファイル情報管理 (パス、サイズ、ハッシュ)
   - 検索・フィルタ機能
   - SaaS同期準備

**Phase 1 合計**: 38日 *(従来32日 +6日)*

### Phase 2: v1.1 SaaS統合（優先度: 高）
**期間**: 3-4週間  
**目標**: SaaS連携による自動環境構築とユーザー管理

#### 🌐 SaaS API基盤
1. **SaaS API基盤構築** (4日) *(Flask基盤から変更)*
   - Node.js/Python API サーバー
   - ユーザー認証・管理システム
   - API設計・実装 (RESTful/GraphQL)
   - セキュリティ実装 (JWT/OAuth)

2. **AWS環境自動構築サービス** (5日) *(新規)*
   - CloudFormation管理システム
   - Cross-Account Role自動設定
   - 環境構築API・ワークフロー
   - エラーハンドリング・ロールバック

3. **常駐アプリ ↔ SaaS連携** (3日) *(新規)*
   - API通信機能 (認証・設定同期)
   - 設定情報の暗号化保存
   - オフライン対応・キャッシュ機能
   - エラーハンドリング・リトライ

#### 🎨 管理・監視機能
4. **SaaS管理ダッシュボード** (4日) *(Web UIから変更)*
   - ユーザー管理画面
   - アーカイブ状況監視
   - 使用量・コスト分析
   - 設定管理インターフェース

5. **課金・ライセンス管理** (3日) *(新規)*
   - サブスクリプション管理
   - 使用量ベース課金
   - ライセンス認証システム
   - 支払い処理連携

6. **システムトレイUI改善** (3日) *(新規)*
   - 高度な進捗表示
   - 設定画面の充実
   - 通知システムの改善
   - ユーザビリティ向上

**Phase 2 合計**: 22日 *(従来17日 +5日)*

### Phase 3: v1.2 編集ソフト連携（優先度: 中）
**期間**: 3-4週間  
**目標**: Premiere Pro / DaVinci Resolve連携

1. **Premiere Pro連携調査** (5日)
   - API仕様調査・技術検証
   - プラグイン開発手法
   - 常駐アプリとの連携方式
   - 技術的実現性検証

2. **エクスポート連携開発** (8日)
   - エクスポート先設定
   - ReelVault連携プラグイン
   - 自動アップロード機能
   - 常駐アプリとの統合

3. **DaVinci Resolve連携調査** (3日)
   - DaVinci Resolve連携の技術調査
   - 実装方式の検討

**Phase 3 合計**: 16日 *(変更なし)*

## 🏗️ 新アーキテクチャ概要

### 🔄 システム構成
```
[監視フォルダ] ←→ [常駐アプリ] ←→ [AWS S3 (ユーザーアカウント)]
                      ↕                        ↑
                [SaaS API] ←→ [AWS環境自動構築]  ↑
                      ↓                        ↑
              [ユーザー管理・課金]               ↑
                                              ↑
                    [データ直接転送 - SaaS経由なし]
```

### 🎮 ユーザーエクスペリエンス
```
1. 常駐アプリインストール・SaaSアカウント作成
2. AWS認証情報入力 → 自動環境構築
3. 監視フォルダ設定
4. プロジェクト完了後、監視フォルダにドラッグ&ドロップ
5. 自動バックアップ開始・システムトレイ通知
```

## 🔄 依存関係マップ (更新)

```
常駐アプリ基盤 → フォルダ監視 → バックグラウンドアップロード
       ↓              ↓                    ↓
CloudFormation → AWS認証・設定 → アップロード機能 → 復元機能
       ↓              ↓                    ↓
   SaaS API → 環境自動構築 → 常駐アプリ連携 → 管理ダッシュボード
                                          ↓
                                   編集ソフト連携
```

## 📊 工数見積もり (更新)

| フェーズ | 期間 | 工数(人日) | 主要成果物 | 変更 |
|---------|------|-----------|-----------|------|
| v1.0 | 5週間 | 38日 | 常駐アプリ、自動バックアップ | +6日 |
| v1.1 | 4週間 | 22日 | SaaS統合、管理機能 | +5日 |
| v1.2 | 4週間 | 16日 | 編集ソフト連携 | 変更なし |
| **合計** | **13週間** | **76日** | **常駐アプリ + SaaS** | **+11日** |

## 🎯 マイルストーン (更新)

### Milestone 1: 常駐アプリMVP (v1.0)
- [ ] 常駐アプリケーション基盤完成
- [ ] フォルダ監視・自動アップロード
- [ ] AWS環境自動構築 (手動設定版)
- [ ] システムトレイUI・通知機能

### Milestone 2: SaaS統合 (v1.1)  
- [ ] SaaS API・ユーザー管理
- [ ] AWS環境自動構築サービス
- [ ] 常駐アプリ ↔ SaaS連携
- [ ] 課金・ライセンス管理

### Milestone 3: 編集ソフト連携 (v1.2)
- [ ] Premiere Pro連携
- [ ] ワークフロー統合
- [ ] β版リリース

## 🔧 技術的課題と対策 (更新)

### 新規追加課題
1. **Cross-Platform常駐アプリ**
   - Electron vs Tauri 技術選定
   - システムリソース使用量最適化
   - OS固有機能の統一実装

2. **ファイルシステム監視**
   - 大量ファイル監視時のパフォーマンス
   - 監視対象フィルタリングの効率化
   - バッテリー消費の最適化

3. **Cross-Account Role認証**
   - セキュリティ設計の複雑さ
   - 権限スコープの最小化
   - 認証エラー時の自動回復

4. **SaaS運用・スケーリング**
   - インフラコスト管理
   - API レート制限対応
   - 障害時の影響範囲最小化

### 既存課題 (継続)
1. **大容量ファイル処理**
   - マルチパート アップロード
   - 並列処理対応
   - 進捗管理・中断再開

2. **AWS コスト最適化**
   - ライフサイクル設定
   - 適切なストレージクラス選択
   - コスト計算・予測機能

## 📚 次ステップ (更新)

1. **技術選定・フィジビリティ調査**
   - Electron vs Tauri 詳細比較
   - Cross-Account Role セキュリティ検証
   - ファイル監視パフォーマンステスト

2. **GitHub Issues 組み替え**
   - 新アーキテクチャに基づくタスク再定義
   - 優先度・依存関係の再設定

3. **開発環境構築**
   - 常駐アプリ開発環境
   - SaaS開発・デプロイ環境

4. **プロトタイプ開発**
   - 最小限の常駐アプリ
   - フォルダ監視機能検証

## 🔄 継続的改善

- 毎週の進捗レビュー
- ユーザーフィードバック収集 (β版)
- パフォーマンス監視・最適化
- セキュリティ更新・監査 